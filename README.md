Signelle
Nicholas Keene, 2019
No rights reserved on this code, anyone can use it for any purpose

Signelle is a chat server, a coding example as part of the Signal interview process.

Note: The project instructions said to use port 80 but using port 80 is a security problem with Java because port 80 is
only accessible with elevated privileges, so Signelle uses port 1080. It can be configured by changing 'port' in
Signelle.java.

----

Build:
mvn clean install

Run:
mvn exec:java -Dexec.mainClass="be.keene.signelle.Signelle"

----

This was pretty fun because I haven't actually touched socket code in Java for quite a while. Projects I've worked on
have either used a library to abstract away the HTTP layer or the web API was written by someone else.

My design is basic, a model (SignelleModel) view (SignellePuller) controller (Actions) pattern and I tried to
abstract out the major functional components, such as the puller vs the processor, and the various sub-components of the
model.

One thing I would definitely change is the way requested resources map to Actions. I have a hokey little set of if
statements in AbstractAction.from() which works but would require new code for new actions. Better solutions might
be regular expressions, which I like and use a lot, or a library which does that specific thing.

In the end I didn't do a lot of testing because I had used up the time you asked me to spend. I didn't go into the model
to see if the data was constructed properly and returned as requested, but I coded every case so you can see all the
ideas.

The model uses a single container for holding all the chat references, but I also considered having a container for
mapping User -> Chats and a separate one for ChatId -> Chats. A more serious impl would need a more robust data model,
probably a proper database.

I only tested this using your test harness which apparently only creates chats and then posts one message to them. I
didn't have time to make a client of my own that would do things like request chat message lists. I assume there
are bugs in that part of the code which I didn't work out, but I completed the logic.

One thing I wasn't confident in was whether I successfully returned the response to the client because I didn't see
the client print the results nor exit at the end. I don't have the day-to-day intuition with NIO to have confidence that
I got the resource life cycle correct. But this log is generated by Signelle so this is what I believe I was returning.

----


-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":14448,"participantIds":[45246,32721]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 14448"

-------------- Signelle Processed Request ----------

POST /chats/14448/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 165
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"2e76de2d-16d9-4e43-ac17-b9179bb8c840","timestamp":1559025353844,"message":"The lawyer tried to lose his case.","sourceUserId":45246,"destinationUserId":32721}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":13603,"participantIds":[61179,58491]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 13603"

-------------- Signelle Processed Request ----------

POST /chats/13603/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 177
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"67f9ebcc-e39f-4222-bcd5-7d8b03007b30","timestamp":1559025384711,"message":"The heart beat strongly and with firm strokes.","sourceUserId":61179,"destinationUserId":58491}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":11472,"participantIds":[56314,44556]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 11472"

-------------- Signelle Processed Request ----------

POST /chats/11472/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 168
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"82c06921-4e4d-4c62-93c9-7ecda769779e","timestamp":1559025353888,"message":"He said the same phrase thirty times.","sourceUserId":56314,"destinationUserId":44556}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":17135,"participantIds":[21926,12147]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 17135"

-------------- Signelle Processed Request ----------

POST /chats/17135/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 166
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"8c1101eb-630f-4f00-a2f3-5f743dd66c59","timestamp":1559025368714,"message":"A small creek cut across the field.","sourceUserId":21926,"destinationUserId":12147}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":18347,"participantIds":[74329,62326]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 18347"

-------------- Signelle Processed Request ----------

POST /chats/18347/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 166
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"22483691-4565-4f76-a105-c302cd5cf762","timestamp":1559025392302,"message":"Wipe the grease off his dirty face.","sourceUserId":74329,"destinationUserId":62326}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":19908,"participantIds":[32640,17725]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 19908"

-------------- Signelle Processed Request ----------

POST /chats/19908/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 176
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"58afe5bb-e076-47d9-a233-c74fd1e60136","timestamp":1559025346245,"message":"Hemp is a weed found in parts of the tropics.","sourceUserId":32640,"destinationUserId":17725}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":16032,"participantIds":[95138,77176]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 16032"

-------------- Signelle Processed Request ----------

POST /chats/16032/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 170
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"2f8e14b7-076d-4fe2-96a7-25f3def33b43","timestamp":1559025418836,"message":"Cars and busses stalled in snow drifts.","sourceUserId":95138,"destinationUserId":77176}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":15815,"participantIds":[38518,77617]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 15815"

-------------- Signelle Processed Request ----------

POST /chats/15815/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 175
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"e63ca1ca-7766-4568-96d9-99247e01d784","timestamp":1559025421897,"message":"Write a fond note to the friend you cherish.","sourceUserId":38518,"destinationUserId":77617}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":17762,"participantIds":[61179,57298]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 17762"

-------------- Signelle Processed Request ----------

POST /chats/17762/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 178
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"41f4c975-466d-4bba-b91c-9f164208b92f","timestamp":1559025358091,"message":"It snowed, rained, and hailed the same morning.","sourceUserId":61179,"destinationUserId":57298}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats/14988/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 173
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"eea1901c-8d22-4a1f-98fb-395a0a62778e","timestamp":1559025370061,"message":"The fin was sharp and cut the clear water.","sourceUserId":78471,"destinationUserId":34769}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":14988,"participantIds":[78471,34769]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 14988"

-------------- Signelle Processed Request ----------

POST /chats/12581/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 167
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"4ad5c117-068e-45e9-98dc-242a35ee0e5e","timestamp":1559025380232,"message":"Rice is often served in round bowls.","sourceUserId":98836,"destinationUserId":32758}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":12581,"participantIds":[98836,32758]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 12581"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":13592,"participantIds":[75319,76812]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 13592"

-------------- Signelle Processed Request ----------

POST /chats/13592/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 174
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"155483ee-e2f0-46fc-ad2f-dd012fa3daa1","timestamp":1559025342088,"message":"The ripe taste of cheese improves with age.","sourceUserId":75319,"destinationUserId":76812}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats/13431/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 162
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"6d735f3e-5582-4522-be59-ad4654d250d9","timestamp":1559025326310,"message":"Two blue fish swam in the tank.","sourceUserId":71279,"destinationUserId":14464}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":13431,"participantIds":[71279,14464]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 13431"

-------------- Signelle Processed Request ----------

POST /chats/10891/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 169
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"06d8dd7c-3932-49e5-b3cc-b2875a719964","timestamp":1559025377968,"message":"Feel the heat of the weak dying flame.","sourceUserId":89899,"destinationUserId":30849}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":10891,"participantIds":[89899,30849]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 10891"

-------------- Signelle Processed Request ----------

POST /chats/11258/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 161
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"33df8f3a-2f2c-4070-99ef-2cd5c3176070","timestamp":1559025392086,"message":"Mesh wire keeps chicks inside.","sourceUserId":17080,"destinationUserId":43441}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":11258,"participantIds":[17080,43441]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 11258"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":11067,"participantIds":[72650,48897]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 11067"

-------------- Signelle Processed Request ----------

POST /chats/11067/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 171
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"0329005e-66a4-44c4-b6ac-70fdc66593cd","timestamp":1559025343413,"message":"The small pup gnawed a hole in the sock.","sourceUserId":72650,"destinationUserId":48897}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 44
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":17951,"participantIds":[102399,26946]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 17951"

-------------- Signelle Processed Request ----------

POST /chats/17951/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 178
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"f50dda84-3ffe-49d5-9545-c1521ae2a0cc","timestamp":1559025371907,"message":"The heart beat strongly and with firm strokes.","sourceUserId":102399,"destinationUserId":26946}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":14709,"participantIds":[38445,14464]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 14709"

-------------- Signelle Processed Request ----------

POST /chats/14709/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 164
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"dce8bcaf-3e50-4edb-9c8c-ec7ee10f066f","timestamp":1559025327157,"message":"The pipe began to rust while new.","sourceUserId":38445,"destinationUserId":14464}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":12097,"participantIds":[13357,77019]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 12097"

-------------- Signelle Processed Request ----------

POST /chats/12097/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 171
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"5257bf66-2137-479e-a325-a0023d44141b","timestamp":1559025427677,"message":"Weave the carpet on the right hand side.","sourceUserId":13357,"destinationUserId":77019}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"

-------------- Signelle Processed Request ----------

POST /chats HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 43
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":11831,"participantIds":[14464,75480]}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 20
Connection: Closed

"Created chat 11831"

-------------- Signelle Processed Request ----------

POST /chats/11831/messages HTTP/1.1
Content-Type: application/json; charset=utf-8
Content-Length: 167
Host: 127.0.0.1:1080
Connection: Keep-Alive
Accept-Encoding: gzip
User-Agent: okhttp/3.12.1

{"id":"a9986c99-461d-4ec4-957e-e19d61c29893","timestamp":1559025350529,"message":"A tusk is used to make costly gifts.","sourceUserId":14464,"destinationUserId":75480}

---------- Signelle Response --------------------

HTTP/1.1 200 OK
Content-Type: application/JSON
Content-Length: 9
Connection: Closed

"Success"
